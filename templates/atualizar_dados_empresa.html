{% extends 'base.html' %}

{% block title %}Atualizar Dados da Empresa{% endblock %}

{% block content %}
<div class="container">
    <div class="container-interno">
        <h1>Atualizar Dados da Empresa</h1>
        <p>
            <a href="{{ url_for('dashboard') }}">Painel de Controle</a> |
            <a href="{{ url_for('dados_empresa') }}">Voltar</a>
        </p>

        <form method="post">
            <h2>Dados do Usuário</h2>
            <div class="form-group">
                <label for="nome">Nome:</label>
                <input type="text" id="nome" name="nome" value="{{ nome }}" required>
            </div>
            <div class="form-group">
                <label for="sobrenome">Sobrenome:</label>
                <input type="text" id="sobrenome" name="sobrenome" value="{{ sobrenome }}" required>
            </div>

            <div class="form-group">
                <label for="data_nascimento">Data de Nascimento:</label>
                <input type="date" id="data_nascimento" name="data_nascimento" value="{{ data_nascimento }}">
            </div>

            <h2>Dados da Empresa</h2>
            <div class="form-group">
                <label for="nome_fantasia">Nome Fantasia:</label>
                <input type="text" id="nome_fantasia" name="nome_fantasia" value="{{ empresa.nome_fantasia if empresa }}">
            </div>

            <div class="form-group">
                <label for="cnpj_sim">CNPJ:</label>
                <select id="cnpj_sim" name="cnpj_sim">
                    <option value="nao" {% if not empresa or not empresa.cnpj %}selected{% endif %}>Não</option>
                    <option value="sim" {% if empresa and empresa.cnpj %}selected{% endif %}>Sim</option>
                </select>
            </div>

            <div id="cnpj_campos" {% if not empresa or not empresa.cnpj %}style="display: none;"{% endif %}>
                <div class="form-group">
                    <label for="cnpj">Número:</label>
                    <input type="text" id="cnpj" name="cnpj" value="{{ empresa.cnpj if empresa }}">
                </div>
                <div class="form-group">
                    <label for="razao_social">Razão Social:</label>
                    <input type="text" id="razao_social" name="razao_social" value="{{ empresa.razao_social if empresa }}">
                </div>
                <div class="form-group">
                    <label for="cnae">CNAE:</label>
                    <input type="text" id="cnae" name="cnae" value="{{ empresa.cnae if empresa }}">
                </div>
                <div class="form-group">
                    <label for="inscricao_estadual">Inscrição Estadual (IE):</label>
                    <input type="text" id="inscricao_estadual" name="inscricao_estadual" value="{{ empresa.inscricao_estadual if empresa }}">
                </div>
                <div class="form-group">
                    <label for="inscricao_municipal">Inscrição Municipal:</label>
                    <input type="text" id="inscricao_municipal" name="inscricao_municipal" value="{{ empresa.inscricao_municipal if empresa }}">
                </div>
                <div class="form-group">
                    <label for="regime_tributario">Regime Tributário:</label>
                    <select id="regime_tributario" name="regime_tributario" value="{{ empresa.regime_tributario if empresa }}">
                        <option value="Simples Nacional">Simples Nacional</option>
                        <option value="Lucro Presumino">Lucro Presumino</option>
                        <option value="Lucro Real">Lucro Real</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label for="cep">CEP:</label>
                <input type="text" id="cep" name="cep" value="{{ empresa.cep if empresa }}">
            </div>
            <div class="form-group">
                <label for="rua">Rua:</label>
                <input type="text" id="rua" name="rua" value="{{ empresa.rua if empresa }}">
            </div>
            <div class="form-group">
                <label for="bairro">Bairro:</label>
                <input type="text" id="bairro" name="bairro" value="{{ empresa.bairro if empresa }}">
            </div>
            <div class="form-group">
                <label for="cidade">Cidade:</label>
                <input type="text" id="cidade" name="cidade" value="{{ empresa.cidade if empresa }}">
            </div>
            <div class="form-group">
                <label for="estado">Estado:</label>
                <input type="text" id="estado" name="estado" value="{{ empresa.estado if empresa }}">
            </div>
            <div class="form-group">
                <label for="pais">País:</label>
                <input type="text" id="pais" name="pais" value="{{ empresa.pais if empresa }}">
            </div>

            <button type="submit">Atualizar</button>
        </form>
    </div>
</div>

<script>
    $(document).ready(function() {
        $('#cnpj_sim').change(function() {
            if ($(this).val() === 'sim') {
                $('#cnpj_campos').show();
            } else {
                $('#cnpj_campos').hide();
            }
        });

        // Implementar a lógica de preenchimento automático do CEP aqui
        $('#cep').blur(function() {
            var cep = $(this).val().replace(/\D/g, '');
            if (cep != "") {
                var validacep = /^[0-9]{8}$/;
                if (validacep.test(cep)) {
                    $.getJSON("https://viacep.com.br/ws/"+ cep +"/json/?callback=?", function(dados) {
                        if (!("erro" in dados)) {
                            $("#rua").val(dados.logradouro);
                            $("#bairro").val(dados.bairro);
                            $("#cidade").val(dados.localidade);
                            $("#estado").val(dados.uf);
                            $("#pais").val("Brasil");
                        } else {
                            alert("CEP não encontrado.");
                        }
                    });
                } else {
                    alert("Formato de CEP inválido.");
                }
            }
        });
    });
</script>
{% endblock %}
